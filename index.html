<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Exam Hall Allocation & Attendance System</title>
  <link rel="stylesheet" href="styles.css" />
  <!-- SheetJS -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <!-- jsPDF + autoTable for reliable PDF generation -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
  <nav class="navbar">
    <div class="container nav-inner">
      
      <div class="brand" style="display: flex; flex-direction: row;"><img src="1st.png" class="1sti" style="width: 70px;" alt=""><h3>ESEC Hall Allocation & Attendance</h3></div>
      <div class="nav-links">
        <a href="#upload">Upload</a>
        
        <a href="#previewSection">Preview & Export</a>
      </div>
    </div>
  </nav>
  <header class="container">
    <h1>Exam Hall Allocation & Attendance System</h1>
    <p class="subtitle">Generate hall-wise seating arrangements and track department-wise attendance</p>
  </header>

  <main class="container">
    <section class="card" id="upload">
      <h2>1. Upload Files</h2>
      <div class="grid-3">
        <div class="file-group">
          <label for="studentsFile">Students.xlsx</label>
          <input type="file" id="studentsFile" accept=".xlsx,.xls" />
          <small>Columns: RegNo, RollNo, Name, Department, SubjectCode columns</small>
        </div>
        <div class="file-group">
          <label for="examsFile">Exams.xlsx</label>
          <input type="file" id="examsFile" accept=".xlsx,.xls" />
          <small>Columns: Date, SubjectCode, SubjectName, Department</small>
        </div>
        <div class="file-group">
          <label for="hallsFile">Halls.xlsx</label>
          <input type="file" id="hallsFile" accept=".xlsx,.xls" />
          <small>Columns: HallName, Capacity</small>
        </div>
      </div>
      <div class="config-grid" style="margin-top:10px">
        <div class="select-group">
          <label for="examTitle">Exam Title</label>
          <input type="text" id="examTitle" placeholder="e.g., END SEMESTER EXAMINATIONS - APRIL/MAY - 2025" />
          <small>Shown as the main title in hall allocation PDFs</small>
        </div>
      </div>
      <div class="actions">
        <button id="parseBtn" class="btn">Parse Files</button>
        <span id="parseStatus" class="muted"></span>
      </div>
    </section>

    <section class="card">
      <h2>2. Hall Allocation (Date-based)</h2>
      <div class="config-grid">
        <div class="select-group">
          <label for="dateSelect">Exam Date</label>
          <select id="dateSelect" disabled>
            <option value="">Select Date</option>
          </select>
        </div>
        <div class="select-group">
          <label for="subjectSelect">Subject (Optional)</label>
          <select id="subjectSelect" disabled>
            <option value="">All subjects on date</option>
          </select>
        </div>
        <div class="actions">
          <button id="allocateBtn" class="btn" disabled>Allocate Halls</button>
        </div>
      </div>
      <div id="hallPreview" class="preview" style="margin-top: 20px;"></div>
      <div class="actions" style="margin-top: 10px;">
        <button id="downloadHallPdfsBtn" class="btn" disabled>Download Hall PDFs</button>
        <button id="downloadSummaryPdfBtn" class="btn" disabled>Download Summary PDF</button>
      </div>
    </section>

    <section class="card" id="attendanceSection">
      <h2>3. Overall Attendance Sheets (Department-wise, All Dates)</h2>
      <div class="config-grid">
        <div class="select-group">
          <label for="deptSelect">Department</label>
          <select id="deptSelect" disabled>
            <option value="">Select Department</option>
          </select>
        </div>
        <div class="actions">
          <button id="generateAttendanceBtn" class="btn" disabled>Generate Attendance Sheet</button>
        </div>
      </div>
      <div id="attendanceContainer" class="attendance-container">
        <div id="examInfo" class="exam-info">
          <h3>Department: <span id="deptName">-</span></h3>
          <p>Overall Attendance Tracking for All Exam Dates</p>
        </div>
        <div class="table-responsive">
          <table id="attendanceTable" class="attendance-table">
            <thead id="attendanceHeader">
              <!-- Will be populated by JavaScript -->
            </thead>
            <tbody id="attendanceBody">
              <!-- Will be populated by JavaScript -->
            </tbody>
            <tfoot id="attendanceFooter">
              <!-- Will be populated by JavaScript -->
            </tfoot>
          </table>
        </div>
      </div>
      <div class="actions" style="margin-top: 20px;">
        <button id="exportAttendancePdfBtn" class="btn" disabled>Download as PDF</button>
      </div>
    </section>
  </main>

  <footer class="container muted small">
    <p>All processing happens in your browser. No data leaves your device.</p>
  </footer>

  <script src="app.js"></script>
  <script>
    // Longer-duration smooth scrolling with navbar offset
    (function(){
      const DURATION = 1200; // ms, increase for slower scroll
      const NAV_OFFSET = 72; // matches CSS scroll-margin-top
      const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      function easeInOutCubic(t){return t<0.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}
      function smoothScrollTo(targetY){
        const startY = window.scrollY || window.pageYOffset;
        const distance = targetY - startY;
        if (prefersReduced){ window.scrollTo(0, targetY); return; }
        let startTime = null;
        function step(ts){
          if (!startTime) startTime = ts;
          const elapsed = ts - startTime;
          const p = Math.min(1, elapsed / DURATION);
          const eased = easeInOutCubic(p);
          window.scrollTo(0, startY + distance * eased);
          if (elapsed < DURATION) requestAnimationFrame(step);
        }
        requestAnimationFrame(step);
      }
      document.addEventListener('click', function(e){
        const a = e.target.closest('a[href^="#"]');
        if (!a) return;
        const id = a.getAttribute('href');
        const el = document.querySelector(id);
        if (!el) return;
        e.preventDefault();
        const rect = el.getBoundingClientRect();
        const targetY = (window.scrollY || window.pageYOffset) + rect.top - NAV_OFFSET;
        smoothScrollTo(targetY);
        history.pushState(null, '', id);
      });
    })();
  </script>
</body>
</html>
